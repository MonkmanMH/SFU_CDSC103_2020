---
title: "Census data - 1"
output: html_notebook
---


```{r setup}
# tidyverse
library(tidyverse)

#
# utilities
library(here)
library(janitor)

```


# Census data

Statistics Canada

[Data products, 2016 Census](https://www12.statcan.gc.ca/census-recensement/2016/dp-pd/index-eng.cfm) -- high-level overview of what's available


Source:  https://www12.statcan.gc.ca/census-recensement/2016/dp-pd/dt-td/Index-eng.cfm 




## Income by census tract


[Household Income Statistics (3) and Household Type Including Census Family Structure (11) for Private Households of Census Metropolitan Areas, Tracted Census Agglomerations and Census Tracts, 2016 Census - 100% Data](https://www12.statcan.gc.ca/census-recensement/2016/dp-pd/dt-td/Rp-eng.cfm?TABID=4&LANG=E&A=R&APATH=3&DETAIL=0&DIM=0&FL=I&FREE=0&GC=001&GL=-1&GID=1241570&GK=10&GRP=1&O=D&PID=110193&PRID=10&PTYPE=109445&S=0&SHOWALL=0&SUB=999&Temporal=2016&THEME=119&VID=0&VNAMEE=&VNAMEF=&D1=0&D2=0&D3=0&D4=0&D5=0&D6=0)


```{r}

df_98_400_X2016100 <- read_csv(here("data", "98-400-X2016100_ENG_CSV", "98-400-X2016100_English_CSV_data.csv"),
                               na = "x")

```


The {janitor} package gives us some tools to quickly clean up the variable names, among other useful tools. Here, we use the `clean_names()` function to put everything into lowercase and replace spaces with underscores.


```{r}

df_98_400_X2016100 <- clean_names(df_98_400_X2016100)


df_98_400_X2016100

```


First: filter by geo_level. In this case, "1" represents the CMAs and tracted CAs

To assign it to another data object that we can refer to later, us the assignment arrow

```{r}

df_CMA <- df_98_400_X2016100 %>% 
  filter(geo_level == 1)

df_CMA

```

## TANGENT: {janitor}

In this case, the name of the "household type" variable has a lot of extra information. We can work with what's there, by putting back ticks around the name. In this example, we can filter our new data frame to just show the total number of households in each region as follows:

```{r}

df_CMA %>%
  filter(`dim_household_type_including_census_family_structure_11` == "Total - Household type including census family structure")

```


But it might be better just to simplify the names themselves. We can do this using the `rename()` function in {dplyr}:


* See [Select/rename variables by name]](https://dplyr.tidyverse.org/reference/select.html) at the {dplyr} reference pages

```{r}

df_CMA <- df_CMA %>%
  rename("household_type" = dim_household_type_including_census_family_structure_11,
         "median_after_tax" = dim_household_income_statistics_3_member_id_3_median_after_tax_income_of_households)

df_CMA_after_tax <- df_CMA %>%
  filter(household_type == "Total - Household type including census family structure") %>% 
  select(geo_name, median_after_tax) %>% 
  arrange(desc(median_after_tax))

df_CMA_after_tax  

```


```{r}

ggplot(df_CMA_after_tax, aes(x = reorder(geo_name, median_after_tax), y = median_after_tax)) +
  coord_flip() +
  geom_point(size = 2) +
  geom_segment(aes(xend = geo_name), yend = 0, colour = "grey50") +
  ylim(0, 150000) +
  theme_light()
  

```


## Census tract table

In this case, we will start again with the master table and use `filter()` to select the cases that are _not_ the CMAs, that is, where `geo_level` is not equal to 1.


```{r}

df_CT <- df_98_400_X2016100 %>% 
  filter(geo_level != 1) %>% 
  rename("household_type" = dim_household_type_including_census_family_structure_11,
         "median_after_tax" = dim_household_income_statistics_3_member_id_3_median_after_tax_income_of_households)


df_CT

```


### Plot: histogram

```{r}

df_CT %>% 
  filter(household_type == "Total - Household type including census family structure") %>% 
  ggplot(aes(x = median_after_tax)) +
    geom_histogram(binwidth = 10000)

```

